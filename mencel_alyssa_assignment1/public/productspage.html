<script src="./products.js" type="text/javascript">
    //links it to products array 
</script>
<script>
    // taken from lab 12 order_page.html and refrenced from the assignment 1 examples
    function isNonNegInt(q, return_errors = false) { //this is a function that will show errors in quantity amount entered for products
        errors = []; //must assume no errors at first
        if (q == "") q = 0; //if a product amount is left blank that means that it will give the quantity of 0
        if (Number(q) != q) errors.push('<font color="red">Not an amount</font>'); // Check if the string is a number
        if (q < 0) errors.push('<font color="red">Negative product amount</font>'); // Check if it is non-negative
        if (parseInt(q) != q) errors.push('<font color="red">Not a complete product amount</font>'); //Check that it is an integer
        return return_errors ? errors : (errors.length == 0); //returns if there are errors or not
    }

    function checkQuantityTextbox(theTextbox) { //Function that gives an error message if there is invalid input
        errs = isNonNegInt(theTextbox.value, true); //setting 'errs' to isNonNegtInt being false for the value entered in quantity_textbox
        document.getElementById(theTextbox.name + '_message').innerHTML = errs.join(", "); //quantity_textbox_message and sets it to the error message from the isNonNegtInt function, gives a comma if more than one error 
    }

    window.onload = function () { //this allows the page and its content to be loaded before the function would be
        let params = (new URL(document.location)).searchParams; //this gets the query string which has the form data

        //The following will check after the form is submitted if the quantities are valid before allowing the consumer to go to the invoice
        if (params.has('submitPurchase')) { 
            errors = false; //must assume quantitites are valid at the start 
            total_qty = 0; // need to check if something was selected so we will look if the total > 0

            //the following checks for every product in the array... 
            for (i = 0; i < products.length; i++) { 

                if (params.has(`quantity_textbox${i}`)) { // check the quantity_textbox for input
                    qty = params.get(`quantity_textbox${i}`); //get the value for quantity_textbox for any product and makes textboxx sticky in case of invalid data
                    product_form[`quantity_textbox${i}`].value = qty; // the value of quantity_textbox is set to variable 'qty'
                    total_qty += qty; // adds the most recently-loaded quantity_textbox value to the total value
                    if (!isNonNegInt(qty)) { // if qty is not a valid input
                        errors = true; // there are errors
                        checkQuantityTextbox(product_form[`quantity_textbox${i}`]); //show where the errors are
                    }

                }

            }
            // Now respond to errors or redirect to invoice if all is ok
            if (errors) { 
                alert("Please enter valid product amounts");
            } else if (total_qty == 0) { // no quantity selections, just give a general alert
                alert("Please select a product ammount before submitting your purchase order");
            }

        }

    }
</script>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sustainable Outfitter's Products</title> <!--Name seen on top of page-->
    <link rel="stylesheet" href="./stylesheets/navbar.css">
    <link rel="stylesheet" href="./stylesheets/products-style.css">
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Oswald">
    <style>
        body {
        text-align: center;
        font-family: 'Oswald', 'Sans';
        color: lightseagreen;
        }
    </style>
</head>
<body>
    <ul>
        <li style="float:left"><a href="./index.html">Sustainable Outfitters</a></li>
        <li><a href="./invoice.html">Shopping Cart</a></li>
        <li><a class="active" href="./productspage.html">Products</a></li>
      </ul>
    <form name="product_main_display" action="process_purchase" method="POST">
        <div>
            <main>
                <script>
                    for (i = 0; i < products.length; i++) {
                        document.write(`
                                <section class="item">
                                    <h2>${products[i].name}</h2>
                                    <br><img src="${products[i].image}">
                                    <p>$${products[i].price}</p>
                                    <label id="quantity${i}_label"}">Quantity</label>
                                    <input type="text" placeholder="" name="quantity${i}" 
                                    onkeyup="checkQuantityTextbox(this);">
                                </section>
                            `);
                    }    
                </script>
            </main>
        </div>
        <footer>
            <input type="submit" value="Purchase!" name="submitPurchase">
        </footer>
    </form>
</body>
</html>